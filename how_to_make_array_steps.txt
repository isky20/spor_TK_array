1. **Freeze your panel rules**

* Genome build (GRCh37 or GRCh38)
* Variant ID format (`chr:pos:ref:alt`)
* Effect allele rule (**ALT = effect allele**)
* SNP-array constraints (target SNP count)

2. **Download PGS scoring files**

* Choose PGS IDs for fitness traits
* Keep metadata (PGS id, method, date, build)

3. **Harmonise PGS to your standard**

* LiftOver if needed (all to one build)
* Remove non-biallelic + non-SNP
* Align alleles; flip beta when needed to enforce **ALT effect**
* Output: `varid  A1(ALT)  beta`

4. **Create the list of required variants**

* Union all harmonised variants across selected PGS
* Deduplicate by `chr:pos:ref:alt`

5. **Query TGD Portal in bulk (your script)**

* Input: the union variant list (convert to TGD format)
* Output: for each variant store:

  * AF (ALT frequency), AC/AN, hom count (if available)
  * flags / clinical significance (optional)
  * status: found / not found / error

6. **Quality checks on TGD results**

* Drop variants not found
* Drop variants with missing AF/AN
* Remove strand-ambiguous (A/T, C/G) unless resolvable
* Check allele consistency between PGS alleles and TGD alleles (drop mismatches)

7. **Turkish population filtering**

* Apply MAF threshold using TGD AF (your rule)
* Keep enough common markers for array performance (avoid too many monomorphic)

8. **LD pruning (Turkey-aware)**

* Use Turkish genotype dataset (if you have PLINK) to clump/prune
* Generate final per-trait SNP sets after LD control

9. **SNP-array design filters**

* Remove SNPs in problematic regions / duplicates / design failures (vendor rules)
* Finalise assayable list

10. **Build final deliverables**

* **Panel manifest**: `chr pos ref alt rsID AF_TURK beta trait PGS_ID flags`
* **Scoring files** per trait: `varid A1 beta`
* **QC list**: sex markers, sample ID, contamination markers, ancestry backbone

11. **Score + reference (if you have Turkish genotypes)**

* Extract panel SNPs from Turkish genotypes
* Compute PRS per trait
* Create Turkish reference percentiles (mean/SD, deciles)

12. **Version + lock**

* Version panel SNP list, PGS sources, TGD snapshot date, pipeline code
* Save all intermediate tables (harmonised PGS, TGD AF, final manifest)
